<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>–¢–µ—Ç—Ä–∏—Å | –° –î–Ω–µ–º –†–æ–∂–¥–µ–Ω–∏—è!</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      touch-action: manipulation;
    }
    body {
      font-family: 'Arial', sans-serif;
      background: #1a1a1a;
      color: white;
      overflow: hidden;
      -webkit-tap-highlight-color: transparent;
    }
    .menu-container {
      position: fixed;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background: linear-gradient(135deg, #2c3e50, #3498db);
      z-index: 2;
    }
    .birthday-card {
      background: rgba(255, 255, 255, 0.95);
      padding: 2rem;
      border-radius: 15px;
      text-align: center;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      max-width: 90%;
      margin: 15px;
    }
    .birthday-card h1 {
      color: #e74c3c;
      margin-bottom: 1rem;
      font-size: clamp(1.5rem, 6vw, 2.5rem);
    }
    .birthday-card p {
      color: #2c3e50;
      margin-bottom: 1.5rem;
      line-height: 1.6;
      font-size: clamp(1rem, 4vw, 1.2rem);
    }
    .start-button {
      background: #27ae60;
      color: white;
      border: none;
      padding: 1rem 2rem;
      font-size: clamp(1rem, 4vw, 1.2rem);
      border-radius: 50px;
      cursor: pointer;
      transition: transform 0.2s, background 0.2s;
    }
    .game-container {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: #1a1a1a;
      z-index: 3;
      padding: 15px;
    }
    .game-header {
      margin-bottom: 1rem;
      text-align: center;
    }
    .game-header h2 {
      font-size: clamp(1.2rem, 6vw, 1.5rem);
    }
    #tetris {
      border: 2px solid #34495e;
      background: #2c3e50;
      max-width: 100%;
      touch-action: none;
    }
    .mobile-controls {
      margin-top: 1.5rem;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
      width: 100%;
      max-width: 400px;
      padding: 0 10px;
    }
    .mobile-controls button {
      background: #34495e;
      border: none;
      color: white;
      padding: 12px;
      border-radius: 8px;
      font-size: 1.2rem;
      touch-action: none;
      min-height: 50px;
    }
    #rotate-btn {
      grid-column: span 3;
    }
    .falling-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 10;
    }
    .petal {
      position: absolute;
      background-size: contain;
      background-repeat: no-repeat;
      opacity: 0.8;
    }
  </style>
</head>
<body>
  <div class="menu-container">
    <div class="birthday-card">
      <h1>üéâ –° –î–Ω–µ–º –†–æ–∂–¥–µ–Ω–∏—è! üéÇ</h1>
      <p>–ñ–µ–ª–∞–µ–º —Ç–µ–±–µ —è—Ä–∫–∏—Ö –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏–π, —É—Å–ø–µ—Ö–æ–≤ –≤–æ –≤—Å–µ—Ö –Ω–∞—á–∏–Ω–∞–Ω–∏—è—Ö –∏ –æ—Ç–ª–∏—á–Ω–æ–≥–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è! üöÄ</p>
      <button class="start-button" onclick="startGame()">–ò–≥—Ä–∞—Ç—å üéÆ</button>
    </div>
  </div>
  <div class="game-container" id="gameContainer">
    <div class="game-header">
      <h2>–û—á–∫–∏: <span id="score">0</span></h2>
    </div>
    <canvas id="tetris"></canvas>
    <div class="mobile-controls">
      <button id="left">‚Üê</button>
      <button id="down">‚Üì</button>
      <button id="right">‚Üí</button>
      <button id="rotate-btn">‚Üª –ü–æ–≤–æ—Ä–æ—Ç</button>
    </div>
  </div>
  <div class="falling-container" id="fallingContainer"></div>

  <script>
    const canvas = document.getElementById('tetris');
    const context = canvas.getContext('2d');
    const scoreElement = document.getElementById('score');
    
    const COLS = 10;
    const ROWS = 20;
    let BLOCK_SIZE = 30;
    let score = 0;
    let gameLoop = null;
    let isGameActive = false;
    
    const SHAPES = [
      [[1,1,1,1]],
      [[1,1],[1,1]],
      [[1,1,1],[0,1,0]],
      [[1,1,1],[1,0,0]],
      [[1,1,1],[0,0,1]],
      [[1,1,0],[0,1,1]],
      [[0,1,1],[1,1,0]]
    ];
    
    const COLORS = ['#e74c3c', '#2ecc71', '#9b59b6', '#f1c40f', '#3498db'];
    const arena = Array(ROWS).fill().map(() => Array(COLS).fill(0));
    let currentPiece = null;

    function calculateBlockSize() {
      const screenWidth = window.innerWidth;
      BLOCK_SIZE = Math.min(30, Math.floor(screenWidth * 0.08));
      canvas.width = COLS * BLOCK_SIZE;
      canvas.height = ROWS * BLOCK_SIZE;
      context.scale(BLOCK_SIZE, BLOCK_SIZE);
    }

    function createPiece() {
      const shape = SHAPES[Math.floor(Math.random() * SHAPES.length)];
      return {
        shape,
        color: COLORS[Math.floor(Math.random() * COLORS.length)],
        x: Math.floor(COLS/2 - shape[0].length/2),
        y: 0
      };
    }

    function collide() {
      return currentPiece.shape.some((row, dy) =>
        row.some((value, dx) =>
          value && (arena[currentPiece.y + dy]?.[currentPiece.x + dx] ||
          currentPiece.x + dx < 0 ||
          currentPiece.x + dx >= COLS ||
          currentPiece.y + dy >= ROWS)
        )
      );
    }

    function merge() {
      currentPiece.shape.forEach((row, y) => {
        row.forEach((value, x) => {
          if (value) arena[currentPiece.y + y][currentPiece.x + x] = currentPiece.color;
        });
      });
    }

    function clearLines() {
      let linesCleared = 0;
      for (let y = ROWS-1; y >= 0; y--) {
        if (arena[y].every(cell => cell)) {
          arena.splice(y, 1);
          arena.unshift(Array(COLS).fill(0));
          linesCleared++;
          y++;
        }
      }
      if (linesCleared) {
        score += linesCleared * 100;
        scoreElement.textContent = score;
        if (score >= 1000) {
          alert("üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –ø–æ–ª—É—á–∞–µ—Ç–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –ø—Ä–∏–∑!");
          resetGame();
        }
      }
    }

    function draw() {
      context.fillStyle = '#2c3e50';
      context.fillRect(0, 0, canvas.width, canvas.height);
      
      arena.forEach((row, y) => {
        row.forEach((value, x) => {
          if (value) {
            context.fillStyle = value;
            context.fillRect(x, y, 1, 1);
          }
        });
      });

      if (currentPiece) {
        context.fillStyle = currentPiece.color;
        currentPiece.shape.forEach((row, y) => {
          row.forEach((value, x) => {
            if (value) {
              context.fillRect(currentPiece.x + x, currentPiece.y + y, 1, 1);
            }
          });
        });
      }
    }

    function update() {
      currentPiece.y++;
      if (collide()) {
        currentPiece.y--;
        merge();
        clearLines();
        currentPiece = createPiece();
        if (collide()) {
          alert(`–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –°—á–µ—Ç: ${score}`);
          resetGame();
        }
      }
      draw();
    }

    function resetGame() {
      isGameActive = false;
      arena.forEach(row => row.fill(0));
      score = 0;
      scoreElement.textContent = score;
      currentPiece = createPiece();
      clearInterval(gameLoop);
      document.querySelector('.menu-container').style.display = 'flex';
      document.getElementById('gameContainer').style.display = 'none';
      startParticles();
    }

    function startGame() {
      isGameActive = true;
      stopParticles();
      calculateBlockSize();
      document.querySelector('.menu-container').style.display = 'none';
      document.getElementById('gameContainer').style.display = 'flex';
      currentPiece = createPiece();
      clearInterval(gameLoop);
      gameLoop = setInterval(update, 1000);
      draw();
    }

    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
    const move = (dx) => {
      currentPiece.x += dx;
      if (collide()) currentPiece.x -= dx;
      draw();
    };

    const rotate = () => {
      const rotated = currentPiece.shape[0].map((_,i) =>
        currentPiece.shape.map(row => row[i]).reverse()
      );
      const previous = currentPiece.shape;
      currentPiece.shape = rotated;
      if (collide()) currentPiece.shape = previous;
      draw();
    };

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
    document.addEventListener('keydown', e => {
      if (!isGameActive) return;
      switch(e.key) {
        case 'ArrowLeft': move(-1); break;
        case 'ArrowRight': move(1); break;
        case 'ArrowDown': update(); break;
        case 'ArrowUp': rotate(); break;
      }
    });

    const touchHandler = (btn) => {
      if (!isGameActive) return;
      switch(btn.id) {
        case 'left': move(-1); break;
        case 'right': move(1); break;
        case 'down': update(); break;
        case 'rotate-btn': rotate(); break;
      }
    };

    document.querySelectorAll('.mobile-controls button').forEach(btn => {
      btn.addEventListener('touchstart', (e) => {
        e.preventDefault();
        touchHandler(btn);
      });
    });

    // –ß–∞—Å—Ç–∏—Ü—ã
    class Particle {
      constructor(isMenu = true) {
        this.element = document.createElement('div');
        this.element.className = `petal petal${Math.random() < 0.5 ? 1 : 2}`;
        this.size = isMenu ? Math.random() * 30 + 20 : 0;
        this.element.style.width = this.size + 'px';
        this.element.style.height = this.size + 'px';
        this.x = Math.random() * window.innerWidth;
        this.y = -this.size;
        this.vx = (Math.random() - 0.5) * (isMenu ? 0.5 : 0);
        this.vy = Math.random() * 2 + 1;
        this.rotation = Math.random() * 360;
        this.rotationSpeed = (Math.random() - 0.5) * 2;
        fallingContainer.appendChild(this.element);
        this.update();
      }
      
      update() {
        if (!this.element) return;
        this.vy += 0.02;
        this.x += this.vx;
        this.y += this.vy;
        this.rotation += this.rotationSpeed;
        
        this.element.style.transform = `translate(${this.x}px, ${this.y}px) rotate(${this.rotation}deg)`;
        
        if (this.y > window.innerHeight + this.size) {
          this.element.remove();
          return false;
        }
        return true;
      }
    }

    let particles = [];
    let particleInterval;

    function startParticles() {
      particleInterval = setInterval(() => {
        particles.push(new Particle(true));
        particles = particles.filter(p => p.update());
      }, 300);
    }

    function stopParticles() {
      clearInterval(particleInterval);
      particles.forEach(p => p.element.remove());
      particles = [];
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    window.addEventListener('resize', calculateBlockSize);
    startParticles();
  </script>
</body>
</html>